#!/bin/bash

EXPECTED_ORIG_FILE_MD5="b1660502ea65d292d9b32a05c6698d2a"
NEW_FILE_EXPECTED_MD5="c09976b2ac4025a0728ba7532efe06cf"


echo "### START untouched auto_master md5:$(md5 -q /etc/auto_master)"



# if backed up original matches stock, remove backup
if [[ $(md5 -q /etc/auto_master) == "$EXPECTED_ORIG_FILE_MD5" ]]; then
  sed -i .bak 's|^/net|#/net|g' /etc/auto_master
  echo "### NEW md5:$(md5 -q /etc/auto_master)"
  cat /etc/auto_master
  if [[ $(md5 -q /etc/auto_master) != $NEW_FILE_EXPECTED_MD5 ]]; then
    echo "### ERROR: new file not expected MD5"
    echo ">>> Changed auto_master"
    cat /etc/auto_master
    echo "<<< Changed auto_master"
    exit 1
  fi
  echo "All good"
  rm /etc/auto_master.bak
  exit 0
else
  echo "### ERROR: Unexpected starting file"
  echo ">>> ORIG: auto_master"
  cat /etc/auto_master
  echo "<<< ORIG: auto_master"
  exit 1
fi




